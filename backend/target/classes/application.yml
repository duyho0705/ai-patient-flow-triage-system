# ---------------------------------------------------------------------------
# Patient Flow & Triage – Main configuration
# Profiles: dev (default), prod
# ---------------------------------------------------------------------------

spring:
  application:
    name: patient-flow-triage

  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  devtools:
    restart:
      enabled: false

  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        default_schema: public
        jdbc:
          time_zone: UTC
        format_sql: true
    # database-platform set per profile (dev=H2, prod=PostgreSQL)

  jackson:
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false
    default-property-inclusion: non_null

  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

  mail:
    host: smtp.gmail.com
    port: 587
    username: ${SPRING_MAIL_USERNAME:your-email@gmail.com}
    password: ${SPRING_MAIL_PASSWORD:your-app-password}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

server:
  port: ${SERVER_PORT:8080}
  error:
    include-message: always

# Actuator: health + info; metrics/auditevents off by default in prod
management:
  endpoints:
    web:
      exposure:
        include: health,info
      base-path: /actuator
  endpoint:
    health:
      show-details: when_authorized
  health:
    db:
      enabled: true

# OpenAPI
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method

# Auth (JWT) – secret nên đặt qua env trong prod
auth:
  jwt:
    secret: ${JWT_SECRET:patient-flow-triage-secret-key-min-256-bits-for-hs256-enterprise}
    expiration-ms: ${JWT_EXPIRATION_MS:86400000}

# AI Triage
triage:
  ai:
    enabled: true
    model-key: triage_acuity_v1
    provider: http-endpoint
    service-url: http://localhost:5000/predict

# LLM Agent (LangChain4j)
langchain4j:
  google-ai-gemini:
    chat-model:
      api-key: ${GEMINI_API_KEY:AIzaSyCOTwwtDxF_DQ1bcM-bcRh9WEsKgikt58Q}
      model-name: gemini-2.0-flash
      temperature: 0.2
      max-output-tokens: 1000

# Payment (VNPAY)
vnpay:
  url: https://sandbox.vnpayment.vn/paymentv2/vpcpay.html
  tmn-code: ${VNP_TMN_CODE:TMNCODE_DEMO}
  hash-secret: ${VNP_HASH_SECRET:SECRET_KEY_DEMO}
  version: "2.1.0"
  command: pay

# Logging
logging:
  level:
    root: INFO
    vn.clinic.patientflow: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
